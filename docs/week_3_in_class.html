<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>6&nbsp; Week 3: Find Actionable Insights, Quickly (In-Class) – Applied Data Analysis for Chinese Lending Data Using R &amp; LLMs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./week_4_pre_class.html" rel="next">
<link href="./week_3_pre_class.html" rel="prev">
<link href="./images/course_logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-29e2c20b02301cfff04dc8050bf30c7e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-7580570a2e354cd56757c689413fca0c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


<meta property="og:title" content="6&nbsp; Week 3: Find Actionable Insights, Quickly (In-Class) – Applied Data Analysis for Chinese Lending Data Using R &amp; LLMs">
<meta property="og:description" content="">
<meta property="og:image" content="week_3_in_class_files/figure-html/unnamed-chunk-19-1.png">
<meta property="og:site_name" content="Applied Data Analysis for Chinese Lending Data Using R &amp; LLMs">
<meta name="twitter:title" content="6&nbsp; Week 3: Find Actionable Insights, Quickly (In-Class) – Applied Data Analysis for Chinese Lending Data Using R &amp; LLMs">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="week_3_in_class_files/figure-html/unnamed-chunk-19-1.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./week_1_pre_class.html">Part 1: Data Analysis Bootcamp</a></li><li class="breadcrumb-item"><a href="./week_3_in_class.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Week 3: Find Actionable Insights, Quickly (In-Class)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Applied Data Analysis for Chinese Lending Data Using R &amp; LLMs</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part 1: Data Analysis Bootcamp</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week_1_pre_class.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Overview</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week_1_in_class.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Week 1: Getting Started (In-Class)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week_2_pre_class.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week 2: Make Cool Charts, Right Away (Pre-Class)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week_2_in_class.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Week 2: Make Cool Charts, Right Away (In-Class)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week_3_pre_class.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Week 3: Find Actionable Insights, Quickly (Pre-Class)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week_3_in_class.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Week 3: Find Actionable Insights, Quickly (In-Class)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week_4_pre_class.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Week 4: Import &amp; Tidy Your Data (Pre-Class)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week_4_in_class.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Week 4: Import &amp; Tidy Your Data (In-Class)</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part 2: Further Resources</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./part_2_resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Resources</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#todays-agenda-90-minutes" id="toc-todays-agenda-90-minutes" class="nav-link active" data-scroll-target="#todays-agenda-90-minutes"><span class="header-section-number">6.1</span> Today’s Agenda (90 minutes)</a></li>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives"><span class="header-section-number">6.2</span> Learning Objectives</a></li>
  <li><a href="#todays-video-lecture" id="toc-todays-video-lecture" class="nav-link" data-scroll-target="#todays-video-lecture"><span class="header-section-number">6.3</span> Today’s Video Lecture</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup"><span class="header-section-number">6.4</span> Setup</a></li>
  <li><a href="#understanding-the-power-of-tidy-data-25-minutes" id="toc-understanding-the-power-of-tidy-data-25-minutes" class="nav-link" data-scroll-target="#understanding-the-power-of-tidy-data-25-minutes"><span class="header-section-number">6.5</span> Understanding the Power of Tidy Data (25 minutes)</a>
  <ul class="collapse">
  <li><a href="#the-aha-moment-why-tidy-data-matters" id="toc-the-aha-moment-why-tidy-data-matters" class="nav-link" data-scroll-target="#the-aha-moment-why-tidy-data-matters"><span class="header-section-number">6.5.1</span> The “Aha!” Moment: Why Tidy Data Matters</a></li>
  <li><a href="#why-this-matters-a-concrete-example" id="toc-why-this-matters-a-concrete-example" class="nav-link" data-scroll-target="#why-this-matters-a-concrete-example"><span class="header-section-number">6.5.2</span> Why This Matters: A Concrete Example</a></li>
  <li><a href="#the-pivoting-power-tools" id="toc-the-pivoting-power-tools" class="nav-link" data-scroll-target="#the-pivoting-power-tools"><span class="header-section-number">6.5.3</span> The Pivoting Power Tools</a></li>
  <li><a href="#key-pattern-the-pivot-dance" id="toc-key-pattern-the-pivot-dance" class="nav-link" data-scroll-target="#key-pattern-the-pivot-dance"><span class="header-section-number">6.5.4</span> Key Pattern: The Pivot Dance</a></li>
  </ul></li>
  <li><a href="#live-demo-finding-non-obvious-insights-20-minutes" id="toc-live-demo-finding-non-obvious-insights-20-minutes" class="nav-link" data-scroll-target="#live-demo-finding-non-obvious-insights-20-minutes"><span class="header-section-number">6.6</span> Live Demo: Finding Non-Obvious Insights (20 minutes)</a>
  <ul class="collapse">
  <li><a href="#setting-up-our-investigation" id="toc-setting-up-our-investigation" class="nav-link" data-scroll-target="#setting-up-our-investigation"><span class="header-section-number">6.6.1</span> Setting Up Our Investigation</a></li>
  <li><a href="#why-pivot-a-simple-example" id="toc-why-pivot-a-simple-example" class="nav-link" data-scroll-target="#why-pivot-a-simple-example"><span class="header-section-number">6.6.2</span> Why Pivot? A Simple Example</a></li>
  <li><a href="#the-pivot-dance-making-comparisons-clear" id="toc-the-pivot-dance-making-comparisons-clear" class="nav-link" data-scroll-target="#the-pivot-dance-making-comparisons-clear"><span class="header-section-number">6.6.3</span> The Pivot Dance: Making Comparisons Clear</a></li>
  <li><a href="#finding-repeatable-factoids" id="toc-finding-repeatable-factoids" class="nav-link" data-scroll-target="#finding-repeatable-factoids"><span class="header-section-number">6.6.4</span> Finding “Repeatable Factoids”</a></li>
  <li><a href="#the-pivot-dance-visualized" id="toc-the-pivot-dance-visualized" class="nav-link" data-scroll-target="#the-pivot-dance-visualized"><span class="header-section-number">6.6.5</span> The Pivot Dance, Visualized</a></li>
  <li><a href="#your-turn-more-complex-patterns" id="toc-your-turn-more-complex-patterns" class="nav-link" data-scroll-target="#your-turn-more-complex-patterns"><span class="header-section-number">6.6.6</span> Your Turn: More Complex Patterns</a></li>
  </ul></li>
  <li><a href="#guided-practice-exploration-40-minutes" id="toc-guided-practice-exploration-40-minutes" class="nav-link" data-scroll-target="#guided-practice-exploration-40-minutes"><span class="header-section-number">6.7</span> Guided Practice &amp; Exploration (40 minutes)</a>
  <ul class="collapse">
  <li><a href="#research-questions-to-explore" id="toc-research-questions-to-explore" class="nav-link" data-scroll-target="#research-questions-to-explore"><span class="header-section-number">6.7.1</span> Research Questions to Explore</a></li>
  <li><a href="#question-set-1-regional-patterns-shifts" id="toc-question-set-1-regional-patterns-shifts" class="nav-link" data-scroll-target="#question-set-1-regional-patterns-shifts"><span class="header-section-number">6.7.2</span> Question Set 1: Regional Patterns &amp; Shifts</a></li>
  <li><a href="#question-set-2-sector-evolution" id="toc-question-set-2-sector-evolution" class="nav-link" data-scroll-target="#question-set-2-sector-evolution"><span class="header-section-number">6.7.3</span> Question Set 2: Sector Evolution</a></li>
  <li><a href="#question-set-3-country-deep-dives" id="toc-question-set-3-country-deep-dives" class="nav-link" data-scroll-target="#question-set-3-country-deep-dives"><span class="header-section-number">6.7.4</span> Question Set 3: Country Deep Dives</a></li>
  </ul></li>
  <li><a href="#working-time-structure-30-minutes" id="toc-working-time-structure-30-minutes" class="nav-link" data-scroll-target="#working-time-structure-30-minutes"><span class="header-section-number">6.8</span> Working Time Structure (30 minutes)</a></li>
  <li><a href="#example-solutions-discoveries" id="toc-example-solutions-discoveries" class="nav-link" data-scroll-target="#example-solutions-discoveries"><span class="header-section-number">6.9</span> Example Solutions &amp; Discoveries</a>
  <ul class="collapse">
  <li><a href="#example-1-regional-shifts-in-focus" id="toc-example-1-regional-shifts-in-focus" class="nav-link" data-scroll-target="#example-1-regional-shifts-in-focus"><span class="header-section-number">6.9.1</span> Example 1: Regional Shifts in Focus</a></li>
  <li><a href="#example-2-sector-evolution-deep-dive" id="toc-example-2-sector-evolution-deep-dive" class="nav-link" data-scroll-target="#example-2-sector-evolution-deep-dive"><span class="header-section-number">6.9.2</span> Example 2: Sector Evolution Deep Dive</a></li>
  <li><a href="#example-3-country-trajectories" id="toc-example-3-country-trajectories" class="nav-link" data-scroll-target="#example-3-country-trajectories"><span class="header-section-number">6.9.3</span> Example 3: Country Trajectories</a></li>
  </ul></li>
  <li><a href="#wrap-up-preview-5-minutes" id="toc-wrap-up-preview-5-minutes" class="nav-link" data-scroll-target="#wrap-up-preview-5-minutes"><span class="header-section-number">6.10</span> Wrap-up &amp; Preview (5 minutes)</a>
  <ul class="collapse">
  <li><a href="#key-takeaways-from-today" id="toc-key-takeaways-from-today" class="nav-link" data-scroll-target="#key-takeaways-from-today"><span class="header-section-number">6.10.1</span> Key Takeaways from Today</a></li>
  </ul></li>
  <li><a href="#resources-for-data-transformation-tidying" id="toc-resources-for-data-transformation-tidying" class="nav-link" data-scroll-target="#resources-for-data-transformation-tidying"><span class="header-section-number">6.11</span> Resources for Data Transformation &amp; Tidying</a>
  <ul class="collapse">
  <li><a href="#essential-references" id="toc-essential-references" class="nav-link" data-scroll-target="#essential-references"><span class="header-section-number">6.11.1</span> Essential References</a></li>
  <li><a href="#advanced-learning" id="toc-advanced-learning" class="nav-link" data-scroll-target="#advanced-learning"><span class="header-section-number">6.11.2</span> Advanced Learning</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps"><span class="header-section-number">6.11.3</span> Next Steps</a></li>
  <li><a href="#preview-of-next-week-data-import-cleaning" id="toc-preview-of-next-week-data-import-cleaning" class="nav-link" data-scroll-target="#preview-of-next-week-data-import-cleaning"><span class="header-section-number">6.11.4</span> Preview of Next Week: Data Import &amp; Cleaning</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./week_1_pre_class.html">Part 1: Data Analysis Bootcamp</a></li><li class="breadcrumb-item"><a href="./week_3_in_class.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Week 3: Find Actionable Insights, Quickly (In-Class)</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-week3_in_class" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Week 3: Find Actionable Insights, Quickly (In-Class)</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="todays-agenda-90-minutes" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="todays-agenda-90-minutes"><span class="header-section-number">6.1</span> Today’s Agenda (90 minutes)</h2>
<ol type="1">
<li><strong>Understanding Pivoting Power</strong> (25 min)
<ul>
<li>Why pivot at all? The insight toolkit concept</li>
<li>Demo with mini dataset:
<ul>
<li>How humans naturally organize data (wide)</li>
<li>Why computers prefer tidy data (long)</li>
<li>Creating insights through strategic pivoting</li>
</ul></li>
<li>Key pattern: longer-&gt;group-&gt;analyze-&gt;wider-&gt;compare</li>
</ul></li>
<li><strong>Live Demo: Finding Non-Obvious Insights</strong> (20 min)
<ul>
<li>Example: Comparing lending patterns
<ul>
<li>Pivot longer to analyze by group</li>
<li>Calculate shares and growth rates</li>
<li>Pivot wider to compare countries/regions</li>
<li>Create “repeatable factoids”</li>
</ul></li>
<li>Pattern recognition in Chinese development finance</li>
</ul></li>
<li><strong>Guided Practice &amp; Exploration</strong> (40 min)
<ul>
<li>Suggested research questions like:
<ul>
<li>How has the sectoral composition of lending changed pre/post BRI?</li>
<li>Which countries have seen the biggest shifts in lending patterns?</li>
<li>What regions show similar lending trajectories?</li>
</ul></li>
<li>Support for individual exploration</li>
<li>Creating compelling visualizations from insights</li>
</ul></li>
<li><strong>Share Discoveries</strong> (5 min)
<ul>
<li>Quick highlights of interesting findings</li>
<li>Preview of next week’s data import &amp; cleaning</li>
</ul></li>
</ol>
</section>
<section id="learning-objectives" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">6.2</span> Learning Objectives</h2>
<p>By the end of this session, you will be able to:</p>
<ol type="1">
<li><strong>Understand</strong> tidy data principles and how they enable powerful data analysis</li>
<li><strong>Use</strong> pivoting strategically as a tool for finding meaningful patterns in data</li>
<li><strong>Create</strong> clear comparisons that highlight key changes in lending patterns</li>
<li><strong>Generate</strong> “repeatable factoids” that effectively communicate insights</li>
<li><strong>Apply</strong> these techniques to find non-obvious patterns in Chinese development finance data</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why This Matters for TUFF Analysis
</div>
</div>
<div class="callout-body-container callout-body">
<p>The skills you’re learning today directly support your work on the TUFF Initiative:</p>
<p><strong>Data Analysis</strong> - Find patterns in project-level data more efficiently - Calculate changes in lending patterns over time - Compare lending across regions, sectors, and time periods - Generate insights for briefs and reports</p>
<p><strong>Common TUFF Tasks Made Easier</strong> - Analyze how source quality varies across different types of projects - Track changes in sectoral composition of lending - Compare lending patterns before and after key events - Calculate shares of lending by region or country - Find similar projects across countries</p>
<p><strong>Real Benefits</strong> - Turn repetitive Excel tasks into efficient R workflows - Spend less time manipulating data, more time finding insights - Create consistent analysis across projects - Generate reproducible factoids for reports - Make compelling visualizations of findings</p>
<p>Remember: While the “pivot dance” might seem abstract at first, it’s a powerful tool for the exact kind of analysis you do every day with Chinese overseas lending data.</p>
</div>
</div>
</section>
<section id="todays-video-lecture" class="level2 page-columns page-full" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="todays-video-lecture"><span class="header-section-number">6.3</span> Today’s Video Lecture</h2>
<p>Watch this video lecture to review the concepts from class 3:</p>
<div class="column-page">
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/eXbjwkABbi0" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</div>
</section>
<section id="setup" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="setup"><span class="header-section-number">6.4</span> Setup</h2>
<p>Let’s get our workspace ready. First, create a new Quarto document for your notes:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new Quarto document</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># File → New File → Quarto Document</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as "week_3_transformation_in_class.qmd" in your week_3/R folder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Install a few new packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pak<span class="sc">::</span><span class="fu">pkg_install</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"slider"</span>,   <span class="co"># for rolling calculations</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"janitor"</span>,  <span class="co"># for making column names snake_case</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"widyr"</span>,    <span class="co"># for tidy correlation calculation</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pheatmap"</span>  <span class="co"># for correlation matrix visualization</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Load the packages we’ll need:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)    <span class="co"># For data transformation tools</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)      <span class="co"># for making column names snake_case</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(slider)       <span class="co"># for rolling calculations</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(widyr)        <span class="co"># for tidy correlation calculation</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)     <span class="co"># for correlation matrix visualization</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(chinadevfin3) <span class="co"># For Chinese development finance data</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(aiddataviz)   <span class="co"># For AidData themed visualizations</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="understanding-the-power-of-tidy-data-25-minutes" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="understanding-the-power-of-tidy-data-25-minutes"><span class="header-section-number">6.5</span> Understanding the Power of Tidy Data (25 minutes)</h2>
<section id="the-aha-moment-why-tidy-data-matters" class="level3" data-number="6.5.1">
<h3 data-number="6.5.1" class="anchored" data-anchor-id="the-aha-moment-why-tidy-data-matters"><span class="header-section-number">6.5.1</span> The “Aha!” Moment: Why Tidy Data Matters</h3>
<p>Think of tidy data as the foundation of a building - get it right, and everything else becomes easier. Just as a well-organized kitchen makes cooking efficient, tidy data makes analysis smooth. It’s the secret ingredient that makes the tidyverse work.</p>
<p>Three simple rules make data tidy</p>
<ol type="1">
<li>Each variable is a column</li>
<li>Each observation is a row</li>
<li>Each value is a cell</li>
</ol>
</section>
<section id="why-this-matters-a-concrete-example" class="level3" data-number="6.5.2">
<h3 data-number="6.5.2" class="anchored" data-anchor-id="why-this-matters-a-concrete-example"><span class="header-section-number">6.5.2</span> Why This Matters: A Concrete Example</h3>
<p>Let’s look at our mini dataset from pre-class in both “natural” and “tidy” formats:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How we often see data (wide format)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>mini_loans <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>country,      <span class="sc">~</span><span class="st">"2018"</span>,  <span class="sc">~</span><span class="st">"2019"</span>,  <span class="sc">~</span><span class="st">"2020"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Angola"</span>,         <span class="fl">1.2</span>,     <span class="fl">2.1</span>,     <span class="fl">0.8</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Pakistan"</span>,       <span class="fl">2.3</span>,     <span class="fl">1.7</span>,     <span class="fl">3.1</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Indonesia"</span>,      <span class="fl">1.8</span>,     <span class="fl">2.2</span>,     <span class="fl">1.5</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>mini_loans</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  country   `2018` `2019` `2020`
  &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 Angola       1.2    2.1    0.8
2 Pakistan     2.3    1.7    3.1
3 Indonesia    1.8    2.2    1.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Same data in tidy format</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>mini_loans_tidy <span class="ot">&lt;-</span> mini_loans <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2020"</span>),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"year"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"amount_bn"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>mini_loans_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 3
  country   year  amount_bn
  &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;
1 Angola    2018        1.2
2 Angola    2019        2.1
3 Angola    2020        0.8
4 Pakistan  2018        2.3
5 Pakistan  2019        1.7
6 Pakistan  2020        3.1
7 Indonesia 2018        1.8
8 Indonesia 2019        2.2
9 Indonesia 2020        1.5</code></pre>
</div>
</div>
<p>Watch what happens when we try to answer these questions:</p>
<ol type="1">
<li><strong>Which country had the highest total lending?</strong></li>
</ol>
<p><strong>Wide format (harder)</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mini_loans <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total =</span> <span class="st">`</span><span class="at">2018</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">2019</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">2020</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  country   `2018` `2019` `2020` total
  &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 Pakistan     2.3    1.7    3.1   7.1
2 Indonesia    1.8    2.2    1.5   5.5
3 Angola       1.2    2.1    0.8   4.1</code></pre>
</div>
</div>
<p>Imagine what this would look like if you had 30 years of data? Or if you wanted to switch years? It’s a pain.</p>
<p><strong>Tidy format (easier)</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mini_loans_tidy <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total =</span> <span class="fu">sum</span>(amount_bn)) <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  country   total
  &lt;chr&gt;     &lt;dbl&gt;
1 Pakistan    7.1
2 Indonesia   5.5
3 Angola      4.1</code></pre>
</div>
</div>
<ol start="2" type="1">
<li><strong>What was the year-over-year growth in lending?</strong></li>
</ol>
<p><strong>Wide format (much harder)</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mini_loans <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">growth_18_19 =</span> (<span class="st">`</span><span class="at">2019</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">2018</span><span class="st">`</span>) <span class="sc">/</span> <span class="st">`</span><span class="at">2018</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">growth_19_20 =</span> (<span class="st">`</span><span class="at">2020</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">2019</span><span class="st">`</span>) <span class="sc">/</span> <span class="st">`</span><span class="at">2019</span><span class="st">`</span> <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 6
  country   `2018` `2019` `2020` growth_18_19 growth_19_20
  &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
1 Angola       1.2    2.1    0.8         75          -61.9
2 Pakistan     2.3    1.7    3.1        -26.1         82.4
3 Indonesia    1.8    2.2    1.5         22.2        -31.8</code></pre>
</div>
</div>
<p><strong>Tidy format (clearer)</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>mini_loans_tidy <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">growth =</span> (amount_bn <span class="sc">-</span> <span class="fu">lag</span>(amount_bn)) <span class="sc">/</span> <span class="fu">lag</span>(amount_bn) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
# Groups:   country [3]
  country   year  amount_bn growth
  &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;
1 Angola    2018        1.2   NA  
2 Pakistan  2018        2.3   NA  
3 Indonesia 2018        1.8   NA  
4 Angola    2019        2.1   75  
5 Pakistan  2019        1.7  -26.1
6 Indonesia 2019        2.2   22.2
7 Angola    2020        0.8  -61.9
8 Pakistan  2020        3.1   82.4
9 Indonesia 2020        1.5  -31.8</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Working with Column Names: backticks vs <code>clean_names()</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>When working with messy column names, you’ll often need to handle spaces, special characters, or numbers at the start of names. Let’s look at your options:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example dataset with messy column names</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>messy_names <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span><span class="st">"Country Name"</span>,  <span class="sc">~</span><span class="st">"2021 Amount"</span>, <span class="sc">~</span><span class="st">"% Change"</span>,  <span class="sc">~</span><span class="st">"Current.Status"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Angola"</span>,            <span class="fl">1.2</span>,            <span class="dv">15</span>,         <span class="st">"Active"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Pakistan"</span>,          <span class="fl">2.3</span>,            <span class="sc">-</span><span class="dv">5</span>,         <span class="st">"Delayed"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Indonesia"</span>,         <span class="fl">1.8</span>,            <span class="dv">10</span>,         <span class="st">"Active"</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at original names</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(messy_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Country Name"   "2021 Amount"    "% Change"       "Current.Status"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># See what clean_names() does</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>messy_names <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "country_name"   "x2021_amount"   "percent_change" "current_status"</code></pre>
</div>
</div>
<p><code>clean_names()</code> transforms column names to <strong>snake_case</strong>, which means:</p>
<ul>
<li>All lowercase letters</li>
<li>Spaces and dots replaced with underscores</li>
<li>Special characters removed</li>
<li>Numbers get an ‘x’ prefix</li>
<li>No spaces or special characters</li>
</ul>
<p>For example:</p>
<ul>
<li>“Country Name” → “country_name”</li>
<li>“2021 Amount” → “x2021_amount”</li>
<li>“% Change” → “percent_change”</li>
<li>“Current.Status” → “current_status”</li>
</ul>
<p><strong>When to use <code>clean_names()</code>:</strong></p>
<ul>
<li>Working with data you’ll analyze extensively</li>
<li>When column names are inconsistent or messy</li>
<li>If you’re primarily doing analysis in R</li>
</ul>
<p><strong>When to stick with backticks:</strong></p>
<ul>
<li>If you plan to pivot column names into observations</li>
<li>When preserving original column formatting is important</li>
<li>When working with data that will be exported back to other systems</li>
</ul>
<p><strong>Pro tip:</strong> If you need to restore original names later:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Store original names</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>original_names <span class="ot">&lt;-</span> <span class="fu">names</span>(messy_names)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean for analysis</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>clean_data <span class="ot">&lt;-</span> messy_names <span class="sc">|&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysis here...</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Restore original names if needed</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(clean_data) <span class="ot">&lt;-</span> original_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="the-pivoting-power-tools" class="level3" data-number="6.5.3">
<h3 data-number="6.5.3" class="anchored" data-anchor-id="the-pivoting-power-tools"><span class="header-section-number">6.5.3</span> The Pivoting Power Tools</h3>
<p>Think of <code>pivot_longer()</code> and <code>pivot_wider()</code> as power tools for data analysis:</p>
<ol type="1">
<li><code>pivot_longer()</code>: Gets data ready for analysis
<ul>
<li>Makes grouped calculations easy</li>
<li>Perfect for time series analysis</li>
<li>Great for aesthetic mapping in ggplot2</li>
</ul></li>
<li><code>pivot_wider()</code>: Helps compare and present
<ul>
<li>Creates comparison columns</li>
<li>Makes it easy to calculate differences</li>
<li>Great for presentation tables</li>
</ul></li>
</ol>
</section>
<section id="key-pattern-the-pivot-dance" class="level3" data-number="6.5.4">
<h3 data-number="6.5.4" class="anchored" data-anchor-id="key-pattern-the-pivot-dance"><span class="header-section-number">6.5.4</span> Key Pattern: The Pivot Dance</h3>
<p>Many powerful insights come from this pattern:</p>
<ol type="1">
<li>Start wide (how we get data)</li>
<li>Pivot longer (to analyze)</li>
<li>Do calculations</li>
<li>Pivot wider (to compare)</li>
<li>Find insights</li>
</ol>
<p>Let’s see this in action with Chinese development finance data…</p>
</section>
</section>
<section id="live-demo-finding-non-obvious-insights-20-minutes" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="live-demo-finding-non-obvious-insights-20-minutes"><span class="header-section-number">6.6</span> Live Demo: Finding Non-Obvious Insights (20 minutes)</h2>
<section id="setting-up-our-investigation" class="level3" data-number="6.6.1">
<h3 data-number="6.6.1" class="anchored" data-anchor-id="setting-up-our-investigation"><span class="header-section-number">6.6.1</span> Setting Up Our Investigation</h3>
<p>Let’s use what we just learned to investigate something interesting: How has Chinese development finance shifted between regions and countries over time? This is a perfect example where pivoting can reveal patterns that aren’t obvious at first glance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, let's get our annual lending data by country</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>country_lending <span class="ot">&lt;-</span> <span class="fu">get_gcdf3_dataset</span>() <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(recommended_for_aggregates <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    country_name,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    commitment_year,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    amount_constant_usd_2021,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    flow_class</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>country_lending</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 17,957 × 4
   country_name commitment_year amount_constant_usd_2021 flow_class
   &lt;chr&gt;                  &lt;int&gt;                    &lt;dbl&gt; &lt;chr&gt;     
 1 Afghanistan             2021                 7111456. ODA-like  
 2 Afghanistan             2021                12600000  ODA-like  
 3 Afghanistan             2021                14400000  ODA-like  
 4 Afghanistan             2021                13000000  ODA-like  
 5 Afghanistan             2021                 7500000  ODA-like  
 6 Afghanistan             2021                      NA  ODA-like  
 7 Afghanistan             2021                 3600000  ODA-like  
 8 Afghanistan             2021                      NA  ODA-like  
 9 Afghanistan             2021                      NA  ODA-like  
10 Afghanistan             2021                      NA  ODA-like  
# ℹ 17,947 more rows</code></pre>
</div>
</div>
</section>
<section id="why-pivot-a-simple-example" class="level3" data-number="6.6.2">
<h3 data-number="6.6.2" class="anchored" data-anchor-id="why-pivot-a-simple-example"><span class="header-section-number">6.6.2</span> Why Pivot? A Simple Example</h3>
<p>Before we dive into complex analysis, let’s understand why pivoting helps. Imagine trying to answer this question: <em>“For each country, what share of total Chinese lending did they receive in each year?”</em></p>
<p>Here’s why this is tricky: 1. We need totals by year (denominator) 2. We need each country’s amount by year (numerator) 3. We need to divide these to get shares</p>
<p>Let’s do this step by step:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Calculate yearly totals</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>yearly_totals <span class="ot">&lt;-</span> country_lending <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(commitment_year) <span class="sc">|&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_lending =</span> <span class="fu">sum</span>(amount_constant_usd_2021, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>yearly_totals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 22 × 2
   commitment_year total_lending
             &lt;int&gt;         &lt;dbl&gt;
 1            2000   5449254748.
 2            2001   7865090260.
 3            2002   7583262571.
 4            2003  10898980576.
 5            2004   9633489123.
 6            2005  30759430968.
 7            2006  34404872463.
 8            2007  37657969766.
 9            2008  43062533399.
10            2009 124014128471.
# ℹ 12 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Calculate each country's yearly amount</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>country_shares <span class="ot">&lt;-</span> country_lending <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(commitment_year, country_name) <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">country_amount =</span> <span class="fu">sum</span>(amount_constant_usd_2021, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Join with totals</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(yearly_totals, <span class="at">by =</span> <span class="st">"commitment_year"</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate shares</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">share =</span> country_amount <span class="sc">/</span> total_lending <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>country_shares</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,594 × 5
   commitment_year country_name     country_amount total_lending  share
             &lt;int&gt; &lt;chr&gt;                     &lt;dbl&gt;         &lt;dbl&gt;  &lt;dbl&gt;
 1            2000 Afghanistan            1283228.   5449254748. 0.0235
 2            2000 Africa, regional             0    5449254748. 0     
 3            2000 Albania                3079748.   5449254748. 0.0565
 4            2000 Algeria                      0    5449254748. 0     
 5            2000 Angola                       0    5449254748. 0     
 6            2000 Bangladesh           284264555.   5449254748. 5.22  
 7            2000 Belarus                1550075.   5449254748. 0.0284
 8            2000 Benin                 46502250.   5449254748. 0.853 
 9            2000 Botswana               6042354.   5449254748. 0.111 
10            2000 Bulgaria               1550075.   5449254748. 0.0284
# ℹ 2,584 more rows</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why This is Hard to Read
</div>
</div>
<div class="callout-body-container callout-body">
<p>Notice how this data is now in “long” format - each row is a country-year observation. While this is great for calculation, it’s hard to see patterns. For instance, can you easily tell how Angola’s share has changed over time compared to Ethiopia’s?</p>
<p>This is where strategic pivoting comes in!</p>
</div>
</div>
</section>
<section id="the-pivot-dance-making-comparisons-clear" class="level3" data-number="6.6.3">
<h3 data-number="6.6.3" class="anchored" data-anchor-id="the-pivot-dance-making-comparisons-clear"><span class="header-section-number">6.6.3</span> The Pivot Dance: Making Comparisons Clear</h3>
<p>Let’s use our “pivot dance” pattern to make this more insightful:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot wider to compare countries over time</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>country_shares_wide <span class="ot">&lt;-</span> country_shares <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(commitment_year, country_name, share) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> commitment_year,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> share,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fill =</span> <span class="dv">0</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>country_shares_wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 153 × 23
   country_name     `2000`  `2001` `2002` `2003`   `2004`  `2005` `2006`  `2007`
   &lt;chr&gt;             &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
 1 Afghanistan      0.0235  0.0358 0.237  0.159   0.759   0.183   0.0775 6.70e-2
 2 Africa, regional 0       0.0637 0      0       0.00286 0       1.33   0      
 3 Albania          0.0565  1.27   0      0.0145  0.0712  0.00871 0      0      
 4 Algeria          0       0      0      0.461   0.0286  0.212   0      2.45e-3
 5 Angola           0       0.211  6.52   0.246  10.3     9.30    7.14   1.04e+1
 6 Bangladesh       5.22   10.2    0.637  0       0.0224  0.366   0.0370 1.11e-2
 7 Belarus          0.0284  0.0384 0.0398 0.0141  0.0143  1.67    0      2.49e-1
 8 Benin            0.853   0.309  0.901  0       0.0534  0.552   0.0222 1.01e-1
 9 Botswana         0.111   0.454  0      0.748   0       0       0.159  9.37e-2
10 Bulgaria         0.0284  0.660  0      0       0       0.00438 0      3.77e-4
# ℹ 143 more rows
# ℹ 14 more variables: `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;,
#   `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;,
#   `2017` &lt;dbl&gt;, `2018` &lt;dbl&gt;, `2019` &lt;dbl&gt;, `2020` &lt;dbl&gt;, `2021` &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we can easily see how shares have changed</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>country_shares_wide <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate change in share from 2013 to 2021</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">share_change =</span> <span class="st">`</span><span class="at">2021</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">2013</span><span class="st">`</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(share_change)) <span class="sc">|&gt;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">|&gt;</span>  <span class="co"># Top 10 countries with increasing shares </span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    country_name,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    share_change,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">2013</span><span class="st">`</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">2021</span><span class="st">`</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   country_name share_change  `2013` `2021`
   &lt;chr&gt;               &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
 1 Argentina           25.6  0.00349  25.7 
 2 Pakistan            14.1  2.06     16.2 
 3 Turkey              10.8  0.122    10.9 
 4 Egypt                4.77 0         4.77
 5 Iraq                 2.64 0.401     3.04
 6 Sri Lanka            2.53 0.603     3.13
 7 Sierra Leone         2.51 0.0850    2.60
 8 Brazil               2.21 0.200     2.41
 9 Bangladesh           1.68 0.323     2.00
10 Mongolia             1.34 1.02      2.37</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The Power of Pivoting
</div>
</div>
<div class="callout-body-container callout-body">
<p>Notice what just happened:</p>
<ol type="1">
<li>We started with country-year data (long format)</li>
<li>Did our calculations (shares)</li>
<li>Pivoted wider to make years into columns</li>
<li>Could easily calculate changes across years</li>
</ol>
<p>This would be much harder without pivoting!</p>
</div>
</div>
</section>
<section id="finding-repeatable-factoids" class="level3" data-number="6.6.4">
<h3 data-number="6.6.4" class="anchored" data-anchor-id="finding-repeatable-factoids"><span class="header-section-number">6.6.4</span> Finding “Repeatable Factoids”</h3>
<p>One of the most valuable skills in data analysis is finding “repeatable factoids” - clear, specific insights that tell a story. Let’s use our pivoted data to find some:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Focus on BRI corridor countries</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>bri_changes <span class="ot">&lt;-</span> country_shares_wide <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country_name <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Pakistan"</span>, <span class="st">"Kazakhstan"</span>, <span class="st">"Indonesia"</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Vietnam"</span>, <span class="st">"Bangladesh"</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_bri =</span> (<span class="st">`</span><span class="at">2014</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">2015</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">2016</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">2017</span><span class="st">`</span>) <span class="sc">/</span> <span class="dv">4</span>,  <span class="co"># Average early BRI</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">late_bri =</span> (<span class="st">`</span><span class="at">2018</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">2019</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">2020</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">2021</span><span class="st">`</span>) <span class="sc">/</span> <span class="dv">4</span>    <span class="co"># Average late BRI</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the biggest changes</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>bri_changes <span class="sc">|&gt;</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">change =</span> (late_bri <span class="sc">-</span> early_bri),</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_change =</span> (late_bri <span class="sc">/</span> early_bri <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(change)) <span class="sc">|&gt;</span> </span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    country_name,</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    early_bri<span class="sc">:</span>pct_change <span class="co"># select all columns btw early_bri and pct_change</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
  country_name early_bri late_bri change pct_change
  &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
1 Pakistan         8.88    12.4    3.48        39.2
2 Bangladesh       0.807    3.47   2.67       331. 
3 Kazakhstan       2.18     1.43  -0.754      -34.6
4 Vietnam          2.23     0.847 -1.39       -62.1
5 Indonesia        4.80     1.95  -2.85       -59.5</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
From Numbers to Insights
</div>
</div>
<div class="callout-body-container callout-body">
<p>This analysis might reveal something like: “Pakistan’s share of Chinese development finance increased from X% before BRI to Y% after BRI, a Z-fold increase.”</p>
<p>These kinds of clear, specific insights are powerful in reports and presentations!</p>
</div>
</div>
</section>
<section id="the-pivot-dance-visualized" class="level3" data-number="6.6.5">
<h3 data-number="6.6.5" class="anchored" data-anchor-id="the-pivot-dance-visualized"><span class="header-section-number">6.6.5</span> The Pivot Dance, Visualized</h3>
<p>Let’s revisit the steps we just took:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    subgraph Pattern
        A[Wide Data] --&gt;|pivot_longer| B[Long Data]
        B --&gt;|group_by &amp; calculate| C[Analysis Results]
        C --&gt;|pivot_wider| D[Comparison View]
        D --&gt;|mutate| E[Final Insights]
    end

    subgraph Example[Chinese Development Finance Example]
        A1[Years as Columns] --&gt;|pivot_longer| B1[Year Column]
        B1 --&gt;|group_by country,&lt;br&gt;calculate shares| C1[Country Shares by Year]
        C1 --&gt;|pivot_wider| D1[Years as Columns Again]
        D1 --&gt;|calculate changes| E1[Share Changes Over Time]
    end

    style Pattern fill:#f0f7ff,stroke:#4a90e2
    style Example fill:#fff3e0,stroke:#f5a623
    style A1 fill:#e8f5e9
    style B1 fill:#e8f5e9
    style C1 fill:#e8f5e9
    style D1 fill:#e8f5e9
    style E1 fill:#e8f5e9
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="your-turn-more-complex-patterns" class="level3" data-number="6.6.6">
<h3 data-number="6.6.6" class="anchored" data-anchor-id="your-turn-more-complex-patterns"><span class="header-section-number">6.6.6</span> Your Turn: More Complex Patterns</h3>
<p>Let’s try something more sophisticated. What if we want to understand how the composition of lending (ODA-like vs OOF-like) has changed in different regions?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start with the data</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>lending_composition <span class="ot">&lt;-</span> <span class="fu">get_gcdf3_dataset</span>() <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(recommended_for_aggregates <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(commitment_year, recipient_region, flow_class) <span class="sc">|&gt;</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">amount_bn =</span> <span class="fu">sum</span>(amount_constant_usd_2021, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fl">1e9</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>lending_composition</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 371 × 4
   commitment_year recipient_region flow_class               amount_bn
             &lt;int&gt; &lt;chr&gt;            &lt;chr&gt;                        &lt;dbl&gt;
 1            2000 Africa           ODA-like                   0.359  
 2            2000 Africa           OOF-like                   0.994  
 3            2000 America          ODA-like                   0.0890 
 4            2000 America          OOF-like                   0      
 5            2000 America          Vague (Official Finance)   0      
 6            2000 Asia             ODA-like                   0.964  
 7            2000 Asia             OOF-like                   2.55   
 8            2000 Europe           ODA-like                   0.00308
 9            2000 Europe           OOF-like                   0.00438
10            2000 Middle East      ODA-like                   0.00248
# ℹ 361 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now let's pivot to make comparisons easy</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>composition_wide <span class="ot">&lt;-</span> lending_composition <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> flow_class,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> amount_bn,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fill =</span> <span class="dv">0</span> <span class="co"># what to put when there is no value</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">total =</span> <span class="st">`</span><span class="at">ODA-like</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">OOF-like</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">Vague (Official Finance)</span><span class="st">`</span>,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">oda_share =</span> <span class="st">`</span><span class="at">ODA-like</span><span class="st">`</span> <span class="sc">/</span> total <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>composition_wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 147 × 7
   commitment_year recipient_region `ODA-like` `OOF-like` Vague (Official Fina…¹
             &lt;int&gt; &lt;chr&gt;                 &lt;dbl&gt;      &lt;dbl&gt;                  &lt;dbl&gt;
 1            2000 Africa              0.359      0.994                  0      
 2            2000 America             0.0890     0                      0      
 3            2000 Asia                0.964      2.55                   0      
 4            2000 Europe              0.00308    0.00438                0      
 5            2000 Middle East         0.00248    0.416                  0      
 6            2000 Oceania             0.0272     0.0276                 0.0128 
 7            2001 Africa              2.56       0.505                  0.0234 
 8            2001 America             0.0804     0.880                  0.00911
 9            2001 Asia                0.834      1.53                   0.0714 
10            2001 Europe              0.0121     0.0589                 0.0996 
# ℹ 137 more rows
# ℹ abbreviated name: ¹​`Vague (Official Finance)`
# ℹ 2 more variables: total &lt;dbl&gt;, oda_share &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why This Pattern Works
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Group and summarize first (get the numbers we want)</li>
<li>Pivot wider to create columns for each flow class</li>
<li>Calculate new metrics using these columns</li>
<li>Ready for visualization or further analysis!</li>
</ol>
</div>
</div>
</section>
</section>
<section id="guided-practice-exploration-40-minutes" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="guided-practice-exploration-40-minutes"><span class="header-section-number">6.7</span> Guided Practice &amp; Exploration (40 minutes)</h2>
<section id="research-questions-to-explore" class="level3" data-number="6.7.1">
<h3 data-number="6.7.1" class="anchored" data-anchor-id="research-questions-to-explore"><span class="header-section-number">6.7.1</span> Research Questions to Explore</h3>
<p>Here are several interesting questions about Chinese development finance that we can investigate using our pivoting toolkit. Feel free to explore these or follow your own curiosity!</p>
</section>
<section id="question-set-1-regional-patterns-shifts" class="level3" data-number="6.7.2">
<h3 data-number="6.7.2" class="anchored" data-anchor-id="question-set-1-regional-patterns-shifts"><span class="header-section-number">6.7.2</span> Question Set 1: Regional Patterns &amp; Shifts</h3>
<ol type="1">
<li><strong>Regional Focus Shifts</strong>
<ul>
<li>How has China’s regional focus changed before and after BRI?</li>
<li>Which regions have seen the biggest changes in their share of total lending?</li>
<li>Are there regions that show similar patterns over time?</li>
</ul></li>
</ol>
<p>Here’s a starting point:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start with annual regional totals</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>regional_patterns <span class="ot">&lt;-</span> <span class="fu">get_gcdf3_dataset</span>() <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(recommended_for_aggregates <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(commitment_year, recipient_region) <span class="sc">|&gt;</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">amount_bn =</span> <span class="fu">sum</span>(amount_constant_usd_2021, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fl">1e9</span>,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>regional_patterns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 147 × 3
   commitment_year recipient_region amount_bn
             &lt;int&gt; &lt;chr&gt;                &lt;dbl&gt;
 1            2000 Africa             1.35   
 2            2000 America            0.0890 
 3            2000 Asia               3.51   
 4            2000 Europe             0.00746
 5            2000 Middle East        0.419  
 6            2000 Oceania            0.0677 
 7            2001 Africa             3.09   
 8            2001 America            0.970  
 9            2001 Asia               2.44   
10            2001 Europe             0.171  
# ℹ 137 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot to calculate regional shares over time</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>regional_shares <span class="ot">&lt;-</span> regional_patterns <span class="sc">|&gt;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(commitment_year) <span class="sc">|&gt;</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_total =</span> <span class="fu">sum</span>(amount_bn),</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">share =</span> amount_bn <span class="sc">/</span> year_total <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>regional_shares</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 147 × 5
   commitment_year recipient_region amount_bn year_total  share
             &lt;int&gt; &lt;chr&gt;                &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;
 1            2000 Africa             1.35          5.45 24.8  
 2            2000 America            0.0890        5.45  1.63 
 3            2000 Asia               3.51          5.45 64.5  
 4            2000 Europe             0.00746       5.45  0.137
 5            2000 Middle East        0.419         5.45  7.69 
 6            2000 Oceania            0.0677        5.45  1.24 
 7            2001 Africa             3.09          7.87 39.3  
 8            2001 America            0.970         7.87 12.3  
 9            2001 Asia               2.44          7.87 31.0  
10            2001 Europe             0.171         7.87  2.17 
# ℹ 137 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now you could:</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Pivot wider to compare regions</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Calculate changes between periods</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Visualize the trends</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="question-set-2-sector-evolution" class="level3" data-number="6.7.3">
<h3 data-number="6.7.3" class="anchored" data-anchor-id="question-set-2-sector-evolution"><span class="header-section-number">6.7.3</span> Question Set 2: Sector Evolution</h3>
<ol start="2" type="1">
<li><strong>Sectoral Changes</strong>
<ul>
<li>Which sectors dominated pre-BRI vs post-BRI?</li>
<li>Are certain sectors more prominent in certain regions?</li>
<li>Has the average project size changed differently across sectors?</li>
</ul></li>
</ol>
<p>Try this approach:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Look at sector patterns</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>sector_patterns <span class="ot">&lt;-</span> <span class="fu">get_gcdf3_dataset</span>() <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(recommended_for_aggregates <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">period =</span> <span class="fu">if_else</span>(</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>      commitment_year <span class="sc">&gt;=</span> <span class="dv">2014</span>,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Post-BRI (2014-2021)"</span>,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Pre-BRI (2000-2013)"</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(period, sector_name) <span class="sc">|&gt;</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_amount_bn =</span> <span class="fu">sum</span>(amount_constant_usd_2021, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fl">1e9</span>,</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">project_count =</span> <span class="fu">n</span>(),</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_size_bn =</span> total_amount_bn <span class="sc">/</span> project_count,</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>sector_patterns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 48 × 5
   period               sector_name    total_amount_bn project_count avg_size_bn
   &lt;chr&gt;                &lt;chr&gt;                    &lt;dbl&gt;         &lt;int&gt;       &lt;dbl&gt;
 1 Post-BRI (2014-2021) ACTION RELATI…           6.76            190     0.0356 
 2 Post-BRI (2014-2021) AGRICULTURE, …           5.77            401     0.0144 
 3 Post-BRI (2014-2021) BANKING AND F…         217.              307     0.708  
 4 Post-BRI (2014-2021) BUSINESS AND …          12.6             153     0.0824 
 5 Post-BRI (2014-2021) COMMUNICATIONS          23.1             279     0.0829 
 6 Post-BRI (2014-2021) DEVELOPMENTAL…           0.977           188     0.00520
 7 Post-BRI (2014-2021) DISASTER PREV…           0.226            27     0.00838
 8 Post-BRI (2014-2021) EDUCATION                5.47           1647     0.00332
 9 Post-BRI (2014-2021) EMERGENCY RES…           1.30            563     0.00230
10 Post-BRI (2014-2021) ENERGY                 162.              611     0.266  
# ℹ 38 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot wider to compare periods</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>sector_comparison <span class="ot">&lt;-</span> sector_patterns <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> period,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(total_amount_bn, project_count, avg_size_bn),</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fill =</span> <span class="dv">0</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>sector_comparison</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 7
   sector_name                     total_amount_bn_Post…¹ total_amount_bn_Pre-…²
   &lt;chr&gt;                                            &lt;dbl&gt;                  &lt;dbl&gt;
 1 ACTION RELATING TO DEBT                          6.76                15.4    
 2 AGRICULTURE, FORESTRY, FISHING                   5.77                 9.30   
 3 BANKING AND FINANCIAL SERVICES                 217.                  15.2    
 4 BUSINESS AND OTHER SERVICES                     12.6                  5.93   
 5 COMMUNICATIONS                                  23.1                 37.7    
 6 DEVELOPMENTAL FOOD AID/FOOD SE…                  0.977                1.08   
 7 DISASTER PREVENTION AND PREPAR…                  0.226                0.00819
 8 EDUCATION                                        5.47                 3.82   
 9 EMERGENCY RESPONSE                               1.30                 0.848  
10 ENERGY                                         162.                 116.     
# ℹ 14 more rows
# ℹ abbreviated names: ¹​`total_amount_bn_Post-BRI (2014-2021)`,
#   ²​`total_amount_bn_Pre-BRI (2000-2013)`
# ℹ 4 more variables: `project_count_Post-BRI (2014-2021)` &lt;int&gt;,
#   `project_count_Pre-BRI (2000-2013)` &lt;int&gt;,
#   `avg_size_bn_Post-BRI (2014-2021)` &lt;dbl&gt;,
#   `avg_size_bn_Pre-BRI (2000-2013)` &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="question-set-3-country-deep-dives" class="level3" data-number="6.7.4">
<h3 data-number="6.7.4" class="anchored" data-anchor-id="question-set-3-country-deep-dives"><span class="header-section-number">6.7.4</span> Question Set 3: Country Deep Dives</h3>
<ol start="3" type="1">
<li><strong>Country-Level Analysis</strong>
<ul>
<li>Which countries have seen the most dramatic changes in lending patterns?</li>
<li>Are there countries that show similar trajectories?</li>
<li>How has the mix of ODA-like vs OOF-like lending evolved in key countries?</li>
</ul></li>
</ol>
<p>Example approach:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze lending patterns for top recipients</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>country_patterns <span class="ot">&lt;-</span> <span class="fu">get_gcdf3_dataset</span>() <span class="sc">|&gt;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(recommended_for_aggregates <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_name) <span class="sc">|&gt;</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_amount_bn =</span> <span class="fu">sum</span>(amount_constant_usd_2021, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fl">1e9</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_amount_bn =</span> <span class="fu">mean</span>(amount_constant_usd_2021, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fl">1e9</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">project_count =</span> <span class="fu">n</span>(),</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Focus on major recipients</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> total_amount_bn, <span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>country_patterns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 4
   country_name total_amount_bn avg_amount_bn project_count
   &lt;chr&gt;                  &lt;dbl&gt;         &lt;dbl&gt;         &lt;int&gt;
 1 Russia                 170.         0.874            251
 2 Argentina              139.         1.06             168
 3 Venezuela              113.         2.40             159
 4 Pakistan               103.         0.323            433
 5 Angola                  65.1        0.255            368
 6 Kazakhstan              64.1        0.501            155
 7 Indonesia               55.2        0.163            400
 8 Brazil                  54.3        0.375            170
 9 Vietnam                 28.9        0.183            178
10 Turkey                  28.3        0.227            144
11 Iran                    28.0        0.389             91
12 Egypt                   27.0        0.351             94
13 Ecuador                 26.6        0.218            189
14 Mongolia                22.0        0.152            208
15 Laos                    21.6        0.117            306
16 Ethiopia                21.4        0.119            261
17 South Africa            21.3        0.0949           304
18 Bangladesh              20.8        0.245            138
19 Sri Lanka               20.5        0.0975           271
20 Sudan                   18.9        0.122            268</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Analysis Strategy
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Start simple: Get basic numbers first</li>
<li>Look for patterns: Use pivoting to compare across dimensions</li>
<li>Go deeper: Follow interesting patterns you discover</li>
<li>Create visuals: Make your findings clear and compelling</li>
<li>Generate insights: Find those “repeatable factoids”</li>
</ol>
</div>
</div>
</section>
</section>
<section id="working-time-structure-30-minutes" class="level2" data-number="6.8">
<h2 data-number="6.8" class="anchored" data-anchor-id="working-time-structure-30-minutes"><span class="header-section-number">6.8</span> Working Time Structure (30 minutes)</h2>
<ol type="1">
<li><strong>First 5 minutes</strong>:
<ul>
<li>Choose a question that interests you</li>
<li>Sketch out your analysis approach</li>
<li>What comparisons will be most revealing?</li>
</ul></li>
<li><strong>Next 20 minutes</strong>:
<ul>
<li>Work on your analysis</li>
<li>Try different approaches</li>
<li>Create visualizations</li>
<li>Look for surprising patterns</li>
</ul></li>
<li><strong>Final 5 minutes</strong>:
<ul>
<li>Refine your most interesting finding</li>
<li>Prepare to share one insight</li>
</ul></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Getting Unstuck
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you get stuck:</p>
<ol type="1">
<li>Break your question into smaller pieces</li>
<li>Try printing intermediate results</li>
<li>Ask yourself: “What comparison would make this clear?”</li>
<li>Remember the pivot dance pattern:
<ul>
<li>Longer for analysis</li>
<li>Wider for comparison</li>
</ul></li>
</ol>
</div>
</div>
</section>
<section id="example-solutions-discoveries" class="level2" data-number="6.9">
<h2 data-number="6.9" class="anchored" data-anchor-id="example-solutions-discoveries"><span class="header-section-number">6.9</span> Example Solutions &amp; Discoveries</h2>
<p>Let’s work through one question from each set to demonstrate the full analysis process.</p>
<section id="example-1-regional-shifts-in-focus" class="level3" data-number="6.9.1">
<h3 data-number="6.9.1" class="anchored" data-anchor-id="example-1-regional-shifts-in-focus"><span class="header-section-number">6.9.1</span> Example 1: Regional Shifts in Focus</h3>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Understanding Factor Ordering in ggplot2
</div>
</div>
<div class="callout-body-container callout-body">
<p>When working with categorical variables in R (like time periods, categories, or rankings), you’ll often need to control their display order. By default, R will either: - Order factors alphabetically - Keep them in the order they first appear in the data</p>
<p>This default behavior rarely matches what we want to show! Here’s how to take control:</p>
<ol type="1">
<li><p><strong>Understand factors</strong>: Think of factors as categorical variables with a specific order. They’re like a numbered list where each category gets a number determining its position.</p></li>
<li><p><strong>Create ordered factors</strong>: Use <code>factor()</code> with two key arguments:</p>
<ul>
<li><code>x</code>: Your categorical variable</li>
<li><code>levels</code>: The desired order of categories</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Creating an ordered time period factor</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">period =</span> <span class="fu">factor</span>(</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>      period,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Past"</span>, <span class="st">"Present"</span>, <span class="st">"Future"</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li><strong>Why this matters</strong>: ggplot2 respects factor ordering for:
<ul>
<li>Axis ordering</li>
<li>Legend ordering</li>
<li>Facet ordering</li>
</ul></li>
<li><strong>Quick tip</strong>: If you need reverse ordering, just reverse your levels vector:</li>
</ol>
<div class="sourceCode" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>levels <span class="ot">=</span> <span class="fu">rev</span>(<span class="fu">c</span>(<span class="st">"Past"</span>, <span class="st">"Present"</span>, <span class="st">"Future"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Remember: Explicit ordering through factors is almost always better than relying on default ordering!</p>
</div>
</div>
<p>Let’s investigate how China’s regional lending focus has changed from pre-BRI to post-BRI:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create clear time periods and calculate regional lending</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>regional_shifts <span class="ot">&lt;-</span> <span class="fu">get_gcdf3_dataset</span>() <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(recommended_for_aggregates <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create period labels</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">period =</span> <span class="fu">case_when</span>(</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>      commitment_year <span class="sc">&lt;=</span> <span class="dv">2013</span> <span class="sc">~</span> <span class="st">"Pre-BRI (2000-2013)"</span>,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>      commitment_year <span class="sc">&lt;=</span> <span class="dv">2017</span> <span class="sc">~</span> <span class="st">"Early BRI (2014-2017)"</span>,</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Late BRI (2018-2021)"</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to factor with explicit ordering - this matters for ggplot2</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">period =</span> <span class="fu">factor</span>(</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>      period,</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Pre-BRI (2000-2013)"</span>,</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Early BRI (2014-2017)"</span>, </span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Late BRI (2018-2021)"</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(period, recipient_region) <span class="sc">|&gt;</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_amount_bn =</span> <span class="fu">sum</span>(amount_constant_usd_2021, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fl">1e9</span>,</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>regional_shifts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 3
   period                recipient_region total_amount_bn
   &lt;fct&gt;                 &lt;chr&gt;                      &lt;dbl&gt;
 1 Pre-BRI (2000-2013)   Africa                    147.  
 2 Pre-BRI (2000-2013)   America                   143.  
 3 Pre-BRI (2000-2013)   Asia                      204.  
 4 Pre-BRI (2000-2013)   Europe                    131.  
 5 Pre-BRI (2000-2013)   Middle East                26.9 
 6 Pre-BRI (2000-2013)   Multi-Region                3.39
 7 Pre-BRI (2000-2013)   Oceania                     8.70
 8 Early BRI (2014-2017) Africa                    113.  
 9 Early BRI (2014-2017) America                   135.  
10 Early BRI (2014-2017) Asia                      140.  
# ℹ 11 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate shares within each period</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>regional_shares <span class="ot">&lt;-</span> regional_shifts <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(period) <span class="sc">|&gt;</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">period_total =</span> <span class="fu">sum</span>(total_amount_bn),</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">share =</span> total_amount_bn <span class="sc">/</span> period_total <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>regional_shares</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 5
   period                recipient_region total_amount_bn period_total  share
   &lt;fct&gt;                 &lt;chr&gt;                      &lt;dbl&gt;        &lt;dbl&gt;  &lt;dbl&gt;
 1 Pre-BRI (2000-2013)   Africa                    147.           664. 22.2  
 2 Pre-BRI (2000-2013)   America                   143.           664. 21.6  
 3 Pre-BRI (2000-2013)   Asia                      204.           664. 30.7  
 4 Pre-BRI (2000-2013)   Europe                    131.           664. 19.7  
 5 Pre-BRI (2000-2013)   Middle East                26.9          664.  4.05 
 6 Pre-BRI (2000-2013)   Multi-Region                3.39         664.  0.510
 7 Pre-BRI (2000-2013)   Oceania                     8.70         664.  1.31 
 8 Early BRI (2014-2017) Africa                    113.           469. 24.1  
 9 Early BRI (2014-2017) America                   135.           469. 28.8  
10 Early BRI (2014-2017) Asia                      140.           469. 29.8  
# ℹ 11 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot wider to compare periods</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>regional_comparison <span class="ot">&lt;-</span> regional_shares <span class="sc">|&gt;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(recipient_region, period, share) <span class="sc">|&gt;</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> period,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> share,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fill =</span> <span class="dv">0</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">early_bri_change =</span> <span class="st">`</span><span class="at">Early BRI (2014-2017)</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">Pre-BRI (2000-2013)</span><span class="st">`</span>,</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">late_bri_change =</span> <span class="st">`</span><span class="at">Late BRI (2018-2021)</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">Early BRI (2014-2017)</span><span class="st">`</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(late_bri_change))</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>regional_comparison</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 6
  recipient_region `Pre-BRI (2000-2013)` `Early BRI (2014-2017)`
  &lt;chr&gt;                            &lt;dbl&gt;                   &lt;dbl&gt;
1 Asia                            30.7                   29.8   
2 America                         21.6                   28.8   
3 Multi-Region                     0.510                  0.0239
4 Europe                          19.7                   11.4   
5 Oceania                          1.31                   0.868 
6 Middle East                      4.05                   5.01  
7 Africa                          22.2                   24.1   
# ℹ 3 more variables: `Late BRI (2018-2021)` &lt;dbl&gt;, early_bri_change &lt;dbl&gt;,
#   late_bri_change &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the changes</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>regional_shares <span class="sc">|&gt;</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> share, <span class="at">y =</span> <span class="fu">fct_rev</span>(period), <span class="at">fill =</span> recipient_region)) <span class="sc">+</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Regional Share of Chinese Development Finance"</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"By BRI Period"</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Share of Total Lending (%)"</span>,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Region"</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>recipient_region</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week_3_in_class_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key Insights from Regional Analysis
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><strong>Pre vs Post BRI</strong>: Lending shifts from Europe to other regions.</li>
<li><strong>Regional Concentration</strong>: We can calculate a Herfindahl-Hirschman Index (HHI) to see if lending has become more concentrated</li>
<li><strong>Timing Patterns</strong>: Some regions show consistent growth while others are more volatile</li>
</ol>
</div>
</div>
</section>
<section id="example-2-sector-evolution-deep-dive" class="level3" data-number="6.9.2">
<h3 data-number="6.9.2" class="anchored" data-anchor-id="example-2-sector-evolution-deep-dive"><span class="header-section-number">6.9.2</span> Example 2: Sector Evolution Deep Dive</h3>
<p>Let’s examine how sectoral focus has changed over time:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, identify major sectors</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>major_sectors <span class="ot">&lt;-</span> <span class="fu">get_gcdf3_dataset</span>() <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(recommended_for_aggregates <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sector_name) <span class="sc">|&gt;</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_amount_bn =</span> <span class="fu">sum</span>(amount_constant_usd_2021, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fl">1e9</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> total_amount_bn, <span class="at">n =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(sector_name)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>major_sectors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "INDUSTRY, MINING, CONSTRUCTION" "ENERGY"                        
[3] "BANKING AND FINANCIAL SERVICES" "TRANSPORT AND STORAGE"         
[5] "OTHER MULTISECTOR"             </code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze these sectors over time</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>sector_evolution <span class="ot">&lt;-</span> <span class="fu">get_gcdf3_dataset</span>() <span class="sc">|&gt;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    recommended_for_aggregates <span class="sc">==</span> <span class="st">"Yes"</span>,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    sector_name <span class="sc">%in%</span> major_sectors</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(commitment_year, sector_name) <span class="sc">|&gt;</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">amount_bn =</span> <span class="fu">sum</span>(amount_constant_usd_2021, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fl">1e9</span>,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">project_count =</span> <span class="fu">n</span>(),</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_project_size =</span> amount_bn <span class="sc">/</span> project_count,</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>sector_evolution</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 109 × 5
   commitment_year sector_name          amount_bn project_count avg_project_size
             &lt;int&gt; &lt;chr&gt;                    &lt;dbl&gt;         &lt;int&gt;            &lt;dbl&gt;
 1            2000 ENERGY                 1.26               14         0.0900  
 2            2000 INDUSTRY, MINING, C…   2.03               30         0.0677  
 3            2000 OTHER MULTISECTOR      0.00155             3         0.000517
 4            2000 TRANSPORT AND STORA…   0.0927              7         0.0132  
 5            2001 BANKING AND FINANCI…   0.0905              1         0.0905  
 6            2001 ENERGY                 1.45               13         0.112   
 7            2001 INDUSTRY, MINING, C…   0.695              14         0.0496  
 8            2001 OTHER MULTISECTOR      0                   3         0       
 9            2001 TRANSPORT AND STORA…   1.51               21         0.0720  
10            2002 BANKING AND FINANCI…   0.632               3         0.211   
# ℹ 99 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate moving averages to smooth volatility</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>sector_trends <span class="ot">&lt;-</span> sector_evolution <span class="sc">|&gt;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sector_name) <span class="sc">|&gt;</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">moving_avg =</span> slider<span class="sc">::</span><span class="fu">slide_dbl</span>(</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>      amount_bn,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">.f =</span> mean,</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">.before =</span> <span class="dv">2</span>,</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">.after =</span> <span class="dv">0</span>,</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">.complete =</span> <span class="cn">TRUE</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>sector_trends</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 109 × 6
   commitment_year sector_name          amount_bn project_count avg_project_size
             &lt;int&gt; &lt;chr&gt;                    &lt;dbl&gt;         &lt;int&gt;            &lt;dbl&gt;
 1            2000 ENERGY                 1.26               14         0.0900  
 2            2000 INDUSTRY, MINING, C…   2.03               30         0.0677  
 3            2000 OTHER MULTISECTOR      0.00155             3         0.000517
 4            2000 TRANSPORT AND STORA…   0.0927              7         0.0132  
 5            2001 BANKING AND FINANCI…   0.0905              1         0.0905  
 6            2001 ENERGY                 1.45               13         0.112   
 7            2001 INDUSTRY, MINING, C…   0.695              14         0.0496  
 8            2001 OTHER MULTISECTOR      0                   3         0       
 9            2001 TRANSPORT AND STORA…   1.51               21         0.0720  
10            2002 BANKING AND FINANCI…   0.632               3         0.211   
# ℹ 99 more rows
# ℹ 1 more variable: moving_avg &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize trends</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>sector_trends <span class="sc">|&gt;</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> commitment_year, <span class="at">y =</span> moving_avg, <span class="at">color =</span> sector_name)) <span class="sc">+</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Evolution of Major Sectors in Chinese Development Finance"</span>,</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"3-Year Moving Average"</span>,</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Annual Commitments (USD Billions)"</span>,</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Sector"</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 10 rows containing missing values or values outside the scale range
(`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week_3_in_class_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="example-3-country-trajectories" class="level3" data-number="6.9.3">
<h3 data-number="6.9.3" class="anchored" data-anchor-id="example-3-country-trajectories"><span class="header-section-number">6.9.3</span> Example 3: Country Trajectories</h3>
<p>Let’s identify countries with similar lending trajectories:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, get the top 15 recipients </span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>top_15_countries <span class="ot">&lt;-</span> <span class="fu">get_gcdf3_dataset</span>() <span class="sc">|&gt;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(recommended_for_aggregates <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_name) <span class="sc">|&gt;</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_amount_bn =</span> <span class="fu">sum</span>(amount_constant_usd_2021, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fl">1e9</span>,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> total_amount_bn, <span class="at">n =</span> <span class="dv">15</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(country_name)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>top_15_countries</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Russia"     "Argentina"  "Venezuela"  "Pakistan"   "Angola"    
 [6] "Kazakhstan" "Indonesia"  "Brazil"     "Vietnam"    "Turkey"    
[11] "Iran"       "Egypt"      "Ecuador"    "Mongolia"   "Laos"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get annual lending data and calculate correlations with {widyr}</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>country_correlations <span class="ot">&lt;-</span> <span class="fu">get_gcdf3_dataset</span>() <span class="sc">|&gt;</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    recommended_for_aggregates <span class="sc">==</span> <span class="st">"Yes"</span>,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    country_name <span class="sc">%in%</span> top_15_countries</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country_name, commitment_year) <span class="sc">|&gt;</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">amount_bn =</span> <span class="fu">sum</span>(amount_constant_usd_2021, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fl">1e9</span>,</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use widyr to calculate correlations</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pairwise_cor</span>(</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">item =</span> country_name,</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">feature =</span> commitment_year,</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> amount_bn</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>country_correlations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 210 × 3
   item1      item2  correlation
   &lt;chr&gt;      &lt;chr&gt;        &lt;dbl&gt;
 1 Argentina  Angola     0.144  
 2 Brazil     Angola     0.594  
 3 Ecuador    Angola     0.504  
 4 Egypt      Angola     0.0198 
 5 Indonesia  Angola     0.481  
 6 Iran       Angola     0.190  
 7 Kazakhstan Angola    -0.00985
 8 Laos       Angola     0.599  
 9 Mongolia   Angola     0.480  
10 Pakistan   Angola     0.213  
# ℹ 200 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to matrix for heatmap</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> country_correlations <span class="sc">|&gt;</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> item2,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> correlation</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">"item1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>cor_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Angola   Argentina    Brazil     Ecuador        Egypt
Argentina   0.144040254          NA 0.2680697 -0.10169336  0.886191523
Brazil      0.594197304  0.26806966        NA  0.13097493  0.193789238
Ecuador     0.504363398 -0.10169336 0.1309749          NA -0.178794605
Egypt       0.019817744  0.88619152 0.1937892 -0.17879460           NA
Indonesia   0.481157449  0.26154222 0.8200718  0.09665565  0.180560628
Iran        0.189533805  0.41856827 0.2573311  0.12946369  0.500507220
Kazakhstan -0.009853296 -0.15467907 0.3898341  0.04809748 -0.062208680
Laos        0.598529987  0.48553084 0.4455089  0.34630253  0.420420081
Mongolia    0.479518467  0.87201111 0.5059099  0.22896507  0.684676834
Pakistan    0.212668436  0.86415461 0.4944549 -0.11868078  0.713147544
Russia      0.411187087 -0.09051623 0.4635253  0.31502563 -0.102977986
Turkey     -0.046570471  0.72642222 0.2128716 -0.15609482  0.682016296
Venezuela   0.289127554 -0.18001270 0.3063249  0.52490876 -0.330961812
Vietnam     0.745416888  0.10525212 0.4175119  0.56848283  0.004267243
Angola               NA  0.14404025 0.5941973  0.50436340  0.019817744
            Indonesia        Iran   Kazakhstan        Laos    Mongolia
Argentina  0.26154222  0.41856827 -0.154679070 0.485530840  0.87201111
Brazil     0.82007179  0.25733109  0.389834131 0.445508938  0.50590987
Ecuador    0.09665565  0.12946369  0.048097481 0.346302534  0.22896507
Egypt      0.18056063  0.50050722 -0.062208680 0.420420081  0.68467683
Indonesia          NA  0.28895454  0.378417066 0.336854799  0.55663025
Iran       0.28895454          NA -0.069630425 0.494732472  0.50012901
Kazakhstan 0.37841707 -0.06963043           NA 0.009582959 -0.09638666
Laos       0.33685480  0.49473247  0.009582959          NA  0.64705907
Mongolia   0.55663025  0.50012901 -0.096386655 0.647059071          NA
Pakistan   0.57311187  0.30315433 -0.050998255 0.435897921  0.86258558
Russia     0.50981954 -0.07274509  0.250155487 0.147091271  0.19704934
Turkey     0.07225434  0.12710981 -0.110587028 0.373406297  0.53184879
Venezuela  0.29788955 -0.23682461  0.047042972 0.021136240  0.03706716
Vietnam    0.29754675  0.14806178  0.158572176 0.672768926  0.33138233
Angola     0.48115745  0.18953381 -0.009853296 0.598529987  0.47951847
              Pakistan      Russia      Turkey   Venezuela     Vietnam
Argentina   0.86415461 -0.09051623  0.72642222 -0.18001270 0.105252118
Brazil      0.49445487  0.46352530  0.21287165  0.30632485 0.417511939
Ecuador    -0.11868078  0.31502563 -0.15609482  0.52490876 0.568482828
Egypt       0.71314754 -0.10297799  0.68201630 -0.33096181 0.004267243
Indonesia   0.57311187  0.50981954  0.07225434  0.29788955 0.297546747
Iran        0.30315433 -0.07274509  0.12710981 -0.23682461 0.148061783
Kazakhstan -0.05099825  0.25015549 -0.11058703  0.04704297 0.158572176
Laos        0.43589792  0.14709127  0.37340630  0.02113624 0.672768926
Mongolia    0.86258558  0.19704934  0.53184879  0.03706716 0.331382330
Pakistan            NA  0.03962180  0.65707926  0.02055394 0.134428821
Russia      0.03962180          NA -0.04308038  0.26260519 0.069225155
Turkey      0.65707926 -0.04308038          NA -0.09024336 0.046694362
Venezuela   0.02055394  0.26260519 -0.09024336          NA 0.323409682
Vietnam     0.13442882  0.06922515  0.04669436  0.32340968          NA
Angola      0.21266844  0.41118709 -0.04657047  0.28912755 0.745416888</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create heatmap using pheatmap package</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  cor_matrix,</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Correlation of Chinese Development Finance Patterns"</span>,</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"white"</span>, <span class="st">"blue"</span>))(<span class="dv">100</span>),</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">101</span>),</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">display_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">number_format =</span> <span class="st">"%.2f"</span>,</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">fontsize_number =</span> <span class="dv">7</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="week_3_in_class_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="wrap-up-preview-5-minutes" class="level2" data-number="6.10">
<h2 data-number="6.10" class="anchored" data-anchor-id="wrap-up-preview-5-minutes"><span class="header-section-number">6.10</span> Wrap-up &amp; Preview (5 minutes)</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Creating Reusable Functions
</div>
</div>
<div class="callout-body-container callout-body">
<p>Want to make your analysis pipelines more efficient? Check out:</p>
<ul>
<li>The <a href="https://dplyr.tidyverse.org/articles/programming.html">Programming with dplyr vignette</a></li>
<li>Examples of turning these patterns into functions</li>
<li>How to handle non-standard evaluation in dplyr functions</li>
</ul>
<p>This is a great next step once you’re comfortable with the basic patterns!</p>
</div>
</div>
<section id="key-takeaways-from-today" class="level3" data-number="6.10.1">
<h3 data-number="6.10.1" class="anchored" data-anchor-id="key-takeaways-from-today"><span class="header-section-number">6.10.1</span> Key Takeaways from Today</h3>
<ol type="1">
<li><strong>The Power of Pivoting</strong>
<ul>
<li>Strategic pivoting reveals patterns</li>
<li>Long format for analysis, wide for comparison</li>
<li>Think about what comparison will be most revealing</li>
</ul></li>
<li><strong>Finding Insights</strong>
<ul>
<li>Start with clear questions</li>
<li>Use multiple approaches</li>
<li>Look for surprising patterns</li>
<li>Create “repeatable factoids”</li>
</ul></li>
<li><strong>Visualization Tips</strong>
<ul>
<li>Show the most important comparison</li>
<li>Choose appropriate scales</li>
<li>Make titles informative</li>
</ul></li>
</ol>
</section>
</section>
<section id="resources-for-data-transformation-tidying" class="level2" data-number="6.11">
<h2 data-number="6.11" class="anchored" data-anchor-id="resources-for-data-transformation-tidying"><span class="header-section-number">6.11</span> Resources for Data Transformation &amp; Tidying</h2>
<section id="essential-references" class="level3" data-number="6.11.1">
<h3 data-number="6.11.1" class="anchored" data-anchor-id="essential-references"><span class="header-section-number">6.11.1</span> Essential References</h3>
<ol type="1">
<li><strong><a href="https://r4ds.hadley.nz/data-tidy">R for Data Science (2e) - Data Tidying</a></strong>
<ul>
<li>Comprehensive introduction to tidy data principles</li>
<li>Clear examples and explanations</li>
<li>Practice exercises to reinforce learning</li>
</ul></li>
<li><strong>Documentation &amp; Cheatsheets</strong>
<ul>
<li><a href="https://rstudio.github.io/cheatsheets/tidyr.pdf">tidyr cheatsheet</a></li>
<li><a href="https://tidyr.tidyverse.org/">tidyr documentation</a></li>
<li><a href="https://dplyr.tidyverse.org/articles/programming.html">dplyr programming vignette</a></li>
</ul></li>
</ol>
</section>
<section id="advanced-learning" class="level3" data-number="6.11.2">
<h3 data-number="6.11.2" class="anchored" data-anchor-id="advanced-learning"><span class="header-section-number">6.11.2</span> Advanced Learning</h3>
<ol type="1">
<li><strong><a href="https://vita.had.co.nz/papers/tidy-data.pdf">Tidy Data Paper</a></strong>
<ul>
<li>Original academic paper by Hadley Wickham</li>
<li>Deep dive into tidy data principles</li>
<li>Advanced concepts and theory</li>
</ul></li>
<li><strong><a href="https://tidyr.tidyverse.org/articles/pivot.html">Complex Pivoting Examples</a></strong>
<ul>
<li>Advanced pivoting techniques</li>
<li>Handling multiple variables</li>
<li>Dealing with complex data structures</li>
</ul></li>
<li><strong><a href="https://juliasilge.github.io/widyr/articles/united_nations.html"><code>{widyr}</code> UN Voting Correlations Vignette</a></strong>
<ul>
<li>Explore UN Voting Patterns with <code>{widyr}</code></li>
<li>Great practical example of power of pivoting to find interesting relationships</li>
</ul></li>
</ol>
</section>
<section id="next-steps" class="level3" data-number="6.11.3">
<h3 data-number="6.11.3" class="anchored" data-anchor-id="next-steps"><span class="header-section-number">6.11.3</span> Next Steps</h3>
<ol type="1">
<li><strong>Practice Daily</strong>
<ul>
<li>Apply these techniques to your own work</li>
<li>Try different pivoting approaches</li>
<li>Create your own “pivot patterns” library</li>
</ul></li>
<li><strong>Build Your Skills</strong>
<ul>
<li>Start with simple pivots</li>
<li>Progress to more complex transformations</li>
<li>Experiment with different visualization approaches</li>
</ul></li>
<li><strong>Share &amp; Learn</strong>
<ul>
<li>Discuss approaches with colleagues</li>
<li>Share interesting findings</li>
<li>Learn from others’ techniques</li>
</ul></li>
</ol>
<p>Remember: Data tidying is a foundational skill that enables all other analysis. Investing time in mastering these concepts will pay dividends throughout your career in data analysis.</p>
</section>
<section id="preview-of-next-week-data-import-cleaning" class="level3" data-number="6.11.4">
<h3 data-number="6.11.4" class="anchored" data-anchor-id="preview-of-next-week-data-import-cleaning"><span class="header-section-number">6.11.4</span> Preview of Next Week: Data Import &amp; Cleaning</h3>
<p>Next week we’ll learn how to:</p>
<ul>
<li>Import data from various sources</li>
<li>Handle common data quality issues</li>
<li>Create reproducible cleaning pipelines</li>
<li>Document data decisions</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Preparing for Next Week
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Think about data cleaning challenges you’ve faced</li>
<li>Review this week’s pivoting patterns</li>
<li>Consider how clean data enables better analysis</li>
</ol>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./week_3_pre_class.html" class="pagination-link" aria-label="Week 3: Find Actionable Insights, Quickly (Pre-Class)">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Week 3: Find Actionable Insights, Quickly (Pre-Class)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./week_4_pre_class.html" class="pagination-link" aria-label="Week 4: Import &amp; Tidy Your Data (Pre-Class)">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Week 4: Import &amp; Tidy Your Data (Pre-Class)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>